<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Data Frame Representations of Elasticsearch Results • uptasticsearch</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">uptasticsearch</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="/index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/UptakeOpenSource/uptasticsearch">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="contents col-md-9">
    <div id="uptasticsearch" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#uptasticsearch" class="anchor"></a>uptasticsearch</h1></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This project tackles the issue of getting data out of Elasticsearch and into a tabular format in R.</p>
</div>
<div id="table-of-contents" class="section level2">
<h2 class="hasAnchor">
<a href="#table-of-contents" class="anchor"></a>Table of contents</h2>
<ol>
<li><a href="#howitworks">How it Works</a></li>
<li><a href="#installation">Installation</a></li>
<li>
<a href="#paragraph2">Usage Examples</a>
<ol>
<li><a href="#example1">Get a Batch of Documents</a></li>
<li><a href="#example2">Aggregation Results</a></li>
</ol>
</li>
<li>
<a href="#nextsteps">Next Steps</a>
<ol>
<li><a href="#authsupport">Auth Support</a></li>
</ol>
</li>
</ol>
</div>
<div id="how-it-works" class="section level2">
<h2 class="hasAnchor">
<a href="#how-it-works" class="anchor"></a>How it Works <a name="howitworks"></a>
</h2>
<p>The core functionality of this package is the <code>es_search</code> function. This returns a <code>data.table</code> containing the parsed result of any given query. Note that this includes <code>aggs</code> queries.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation <a name="installation"></a>
</h2>
<p>The package is not yet on CRAN, but we’ll be submitting soon. For now, you can install using <code>devtools</code>.</p>
<pre><code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github("UptakeOpenSource/uptasticsearch", subdir = 'r-pkg/uptasticsearch')</a></code></pre>
</div>
<div id="usage-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#usage-examples" class="anchor"></a>Usage Examples <a name="examples"></a>
</h2>
<p>The examples presented here pertain to a fictional Elasticsearch index holding some information on a movie theater business.</p>
<div id="example-1-get-a-batch-of-documents" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-get-a-batch-of-documents" class="anchor"></a>Example 1: Get a Batch of Documents <a name="example1"></a>
</h3>
<p>The most common use case for this package will be the case where you have an ES query and want to get a data frame representation of many resulting documents.</p>
<p>In the example below, we use <code>uptasticsearch</code> to look for all survey results in which customers said their satisfaction was “low” or “very low” and mentioned food in their comments.</p>
<pre><code># Build your query in an R string
qbody &lt;- '{
  "query": {
    "filtered": {
      "filter": {
        "bool": {
          "must": [
            {
              "exists": {
                "field": "customer_comments"
              }
            },
            {
              "terms": {
                "overall_satisfaction": ["very low", "low"]
              }
            }
          ]
        }
      }
    },
    "query": {
      "match_phrase": {
        "customer_comments": "food"
      }
    }
  }
}'

# Execute the query, parse into a data.table
commentDT &lt;- es_search(es_host = 'http://mydb.mycompany.com:9200'
                       , es_index = "survey_results"
                       , query_body = qbody
                       , scroll = "1m"
                       , n_cores = 4)</code></pre>
</div>
<div id="example-2-aggregation-results" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-aggregation-results" class="anchor"></a>Example 2: Aggregation Results <a name="example2"></a>
</h3>
<p>Elasticsearch ships with a rich set of aggregations for creating summarized views of your data. <code>uptasticsearch</code> has built-in support for these aggregations.</p>
<p>In the example below, we use <code>uptasticsearch</code> to create daily timeseries of summary statistics like total revenue and average payment amount.</p>
<pre><code># Build your query in an R string
qbody &lt;- '{
  "query": {
    "filtered": {
      "filter": {
        "bool": {
          "must": [
            {
              "exists": {
                "field": "pmt_amount"
              }
            }
          ]
        }
      }
    }
  },
  "aggs": {
    "timestamp": {
      "date_histogram": {
        "field": "timestamp",
        "interval": "day"
      },
      "aggs": {
        "revenue": {
          "extended_stats": {
            "field": "pmt_amount"
          }
        }
      }
    }
  },
  "size": 0
}'

# Execute the query, parse result into a data.table
revenueDT &lt;- es_search(es_host = 'http://mydb.mycompany.com:9200'
                       , es_index = "transactions"
                       , size = 1000
                       , query_body = qbody
                       , n_cores = 1)</code></pre>
<p>In the example above, we used the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html">date_histogram</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-extendedstats-aggregation.html">extended_stats</a> aggregations. <code>es_search</code> has built-in support for many other aggregations and combinations of aggregations, with more on the way. Please see the table below for the current status of the package. Note that names of the form “agg1 - agg2” refer to the ability to handled aggregations nested inside other aggregations.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Agg type</th>
<th align="center">R support?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2sn5Qiw">“cardinality”</a></td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2qIR97Z">“date_histogram”</a></td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - cardinality</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">date_histogram - extended_stats</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - histogram</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">date_histogram - percentiles</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - significant_terms</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">date_histogram - stats</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - terms</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2qKqsDU">“extended_stats”</a></td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2sn4LXF">“histogram”</a></td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2sy4z7f">“percentiles”</a></td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/1KnhT1r">“significant terms”</a></td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2sn1t74">“stats”</a></td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2mJyQ0C">“terms”</a></td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - cardinality</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - cardinality</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram - extended_stats</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - histogram</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram - percentiles</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - significant_terms</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram - stats</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - terms</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - extended_stats</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - histogram</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - percentiles</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - significant_terms</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left">terms - stats</td>
<td align="center">YES</td>
</tr>
<tr class="even">
<td align="left">terms - terms</td>
<td align="center">YES</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2sn1t74">“stats”</a></td>
<td align="center">YES</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="next-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next Steps <a name="nextsteps"></a>
</h2>
<p>This is a fairly new project and, as the version number indicates, should be regarded as a work in progress.</p>
<div id="auth-support" class="section level3">
<h3 class="hasAnchor">
<a href="#auth-support" class="anchor"></a>Auth Support <a name="authsupport"></a>
</h3>
<p><code>uptasticsearch</code> does not currently support queries with authentication. This will be added in future versions.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3" id="sidebar">
    <h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/UptakeOpenSource/uptasticsearch">https://​github.com/​UptakeOpenSource/​uptasticsearch</a>
</li>
<li>Report a bug at <br><a href="https://github.com/UptakeOpenSource/uptasticsearch/issues">https://​github.com/​UptakeOpenSource/​uptasticsearch/​issues</a>
</li>
</ul>
<h2>License</h2>
<p><a href="https://opensource.org/licenses/BSD-3-Clause">BSD_3_clause</a> + file <a href="LICENSE.html">LICENSE</a></p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>James Lamb <br><small class="roles"> Author, maintainer </small> </li>
<li>Nick Paras <br><small class="roles"> Author </small> </li>
<li>Austin Dickey <br><small class="roles"> Author </small> </li>
<li>Uptake Technologies Inc. <br><small class="roles"> Copyright holder, funder </small> </li>
</ul>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by James Lamb, Nick Paras, Austin Dickey, Uptake Technologies Inc..</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
